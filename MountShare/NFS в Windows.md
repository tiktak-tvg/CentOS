### Устанавливаем и настраиваем NFS-клиент в Windows.

Сетевая файловая система NFS является родным для мира Linux способом организации общего доступа к файлам по сети и ее взаимоотношения с Windows долгое время оставались напряженными.<br> 
Однако последнее время ситуация начала меняться и Windows перешел от конфронтации к сотрудничеству с открытым ПО.<br> 
Начиная с Windows 10 1607 (14393) в системе появился штатный NFS-клиент, который позволяет прозрачно подключать и использовать NFS-ресурсы.<br>

Для установки NFS-клиента откройте оснастку Программы и компоненты и перейдите по ссылке Включение или отключение компонентов Windows, найдите там раздел Службы для NFS и включите его содержимое.

<img width="1007" height="634" alt="image" src="https://github.com/user-attachments/assets/84643dbf-9c97-44e7-b4ee-ef0c5f89031d" />

#### Подключение через powershell.
Для выполнения команды нужно запустить терминал с повышенными правами:
```bash
Enable-WindowsOptionalFeature -FeatureName ServicesForNFS-ClientOnly, ClientForNFS-Infrastructure -Online -NoRestart
```
Графических инструментов для подключения NFS-ресурсов нет, поэтому снова воспользуемся терминалом, только теперь запустим его без повышения прав:
```bash
mount -o anon \\192.168.233.184\mnt\nfs\doc Z:
```
Команда mount поддерживает ряд опций, которые указываются после ключа -o, в данном случае опция одна - anon, что означает подключение анонимным пользователем. Затем указываем сетевой путь к экспортируемому ресурсу, обратите внимание, что NFS-клиент для Windows поддерживает только NFS v3 и поэтому путь нужно указывать не от корня NFS, а от корня файловой системы. И наконец буква диска куда будет примонтирован ресурс. Адрес NFS-сервера в нашем случае 192.168.233.184.

Если нигде не было допущено ошибок, то в проводнике появится новый сетевой диск с указанной буквой.                                                                                                                                            

<img width="972" height="636" alt="image" src="https://github.com/user-attachments/assets/508a086b-5c2d-4f63-b695-55928c7b8976" />
                                                                                                                                            
Для отключение используйте команду:
```bash
umount Z:
```
У команды mount есть один существенный недостаток, сетевые диски, подключенные таким образом, не восстанавливаются при загрузке системы. Можно, конечно, пойти наиболее простым путем и добавить в автозагрузку пакетный файл с нужными командами, но лучше снова позвать на помощь PowerShell. Данную команду также нужно выполнять без повышения прав:
```bash
New-PSdrive -PSProvider FileSystem -Name Z -Root \\192.168.233.184\mnt\nfs\doc -Persist
```
Обратите внимание, что букву диска для монтирования указываем без двоеточия, а опция -Persist предписывает подключить ресурс на постоянной основе.

Для отключения ресурса воспользуйтесь командой:
```bash
Remove-PSdrive -Name Z
```
Для просмотра всех смонтированных NFS-ресурсов, неважно как они были подключены, используйте команду:
```bash
mount                                                                                                                                            
```
<img width="738" height="230" alt="image" src="https://github.com/user-attachments/assets/8d9c31ad-564a-4641-a6b0-3fdeb1272478" />

Как можем увидеть, при анонимном подключении Windows использует UID/GID = -2, если мы используем all_squash со стороны NFS-сервера, то это не имеет особого значения, в иных случаях нам может потребоваться указать иные идентификаторы. Это можно сделать через системный реестр, откройте ветвь:
```bash
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ClientForNFS\CurrentVersion\Default
```
И добавьте туда два параметра DWORD (32бит) с именами AnonymousUid и AnonymousGid и укажите в них нужные идентификаторы в десятичном виде. После чего перезагрузите компьютер.

А теперь о проблемах. Для их понимания достаточно посмотреть на следующий скриншот:

<img width="937" height="655" alt="image" src="https://github.com/user-attachments/assets/7e3d43c7-a92c-4c34-8a07-157302bcc003" />

Начнем с самого безобидного, регистра в именах файлов. Как мы помним - Linux система чувствительная к регистру, поэтому там TEST.txt и test.txt разные файлы. И если вы будете работать с ними в пределах NFS-ресурса, то проблем не возникнет, вы можете даже открыть оба файла одновременно, внести изменения и сохранить. Все это возможно потому, что NFS - это не протокол удаленного доступа, а именно сетевая файловая система.

Проблемы начнутся, если вы захотите скопировать их в свою систему. Неопытный пользователь вполне может допустить ошибку и перезаписать важный локальный файл.

А вот следующая проблема куда серьезней и не имеет приемлемого решения на сегодняшний день. Современные Linux системы давно работают с UTF-8, в то время как Windows продолжает использовать региональные кодовые страницы, например, CP-1251 для русского языка. Это приводит к тому, что имена файлов, набранные кириллицей (или любыми иными национальными символами) отображаются "крякозябликами". Сами файлы при этом доступны и могут быть отредактированы.

Если же мы со стороны Windows поместим на NFS-ресурс файл с кириллицей в имени, то со стороны Linux мы увидим веселые ромбики.

<img width="825" height="578" alt="image" src="https://github.com/user-attachments/assets/f57ab244-cc7c-48b2-956a-f2cd3952b851" />

В качестве решения можно найти совет включить поддержку UTF-8 в Windows, которая пока находится в состоянии бета. Эта возможность доступа в языковых настройках панели управления.

<img width="530" height="544" alt="image" src="https://github.com/user-attachments/assets/3181d8e5-7db5-454b-8e37-13ff74db9fd1" />

Но это решение из разряда "одно лечим - другое калечим" и покалечено будет гораздо больше, чем вылечено. Дело в том, что достаточно большое количество вполне современных программ ничего не знают об UTF-8 и не умеют с ним работать, в итоге веселые ромбики начнут попадаться вам в самых неожиданных местах вашей системы.

Поэтому, используя NFS-клиент для Windows следует четко понимать все плюсы, минусы и имеющиеся недостатки. Но в целом появление поддержки NFS в Windows - хорошо, так как делает поддержку гетерогенных сред проще.
                                                                                                                                     
